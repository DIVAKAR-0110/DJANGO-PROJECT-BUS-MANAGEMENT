{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Registration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" icon="image/x-icon" href="{% static 'image/bus_logo.png' %}">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: url("{% static 'image/studentlogin.jpg' %}") no-repeat center center fixed;
      background-size: cover;
      font-family: 'Segoe UI', sans-serif;
    }
    .form-container {
      background-color: rgba(255, 255, 255, 0.95);
      padding: 30px;
      margin-top: 50px;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
    }
    .form-floating > label {
      padding-left: 0.75rem;
    }
    .preview-img {
      max-width: 120px;
      margin-top: 10px;
      display: none;
    }
    .toggle-password {
      position: absolute;
      right: 10px;
      top: 12px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="col-md-8 offset-md-2 form-container">
    <h3 class="text-center mb-4">Student Registration Form</h3>
    <form id="studentForm" method="POST" action="#" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="form-floating mb-3">
        <input type="text" class="form-control" name="full_name" id="full_name" placeholder="Full Name" required>
        <label for="full_name">Full Name</label>
      </div>

      <!-- Student ID -->
      <div class="form-floating mb-3">
        <input type="text" class="form-control" name="student_id" id="student_id" placeholder="Student ID" required>
        <label for="student_id">Student ID</label>
      </div>

      <!-- DOB -->
      <div class="form-floating mb-3">
        <input type="date" class="form-control" name="dob" id="dob" required>
        <label for="dob">Date of Birth</label>
      </div>

      <!-- Gender -->
      <div class="form-floating mb-3">
        <select class="form-select" name="gender" id="gender" required>
          <option value="" disabled selected>Select Gender</option>
          <option>Male</option>
          <option>Female</option>
          <option>Other</option>
        </select>
        <label for="gender">Gender</label>
      </div>

      <!-- Blood Group -->
      <div class="form-floating mb-3">
        <select class="form-select" name="blood_group" id="blood_group" required>
          <option value="" disabled selected>Select Blood Group</option>
          <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
          <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
        </select>
        <label for="blood_group">Blood Group</label>
      </div>

      <!-- Photo Upload -->
      <div class="mb-3">
        <label for="student_photo" class="form-label">Upload Photo</label>
        <input type="file" class="form-control" name="student_photo" id="student_photo" accept="image/*" required>
        <img id="photoPreview" class="preview-img" alt="Preview">
      </div>

      <!-- Course Name -->
      <div class="form-floating mb-3">
        <input type="text" list="courses" class="form-control" name="course_name" id="course_name" placeholder="Course Name" required>
        <label for="course_name">Course Name</label>
        <datalist id="courses">
          <option value="B.Sc Computer Science">
          <option value="B.Tech IT">
          <option value="B.Com">
          <option value="BBA">
        </datalist>
      </div>

      <!-- Department -->
      <div class="form-floating mb-3">
        <input type="text" list="departments" class="form-control" name="department" id="department" placeholder="Department" required>
        <label for="department">Department</label>
        <datalist id="departments">
          <option value="Computer Science">
          <option value="Mechanical">
          <option value="Electronics">
        </datalist>
      </div>

      <!-- Year & Semester -->
      <div class="form-floating mb-3">
        <input type="text" class="form-control" name="year_semester" id="year_semester" placeholder="Year / Semester" required>
        <label for="year_semester">Year / Semester</label>
      </div>

      <!-- Batch Year -->
      <div class="form-floating mb-3">
        <input type="text" class="form-control" name="batch_year" id="batch_year" placeholder="Batch Year" required>
        <label for="batch_year">Batch Year</label>
      </div>

      <!-- Phone Number -->
      <div class="form-floating mb-3">
        <input type="tel" class="form-control" name="phone_number" id="phone_number" placeholder="Phone Number" required>
        <label for="phone_number">Phone Number</label>
      </div>

      <!-- Email -->
      <div class="form-floating mb-3">
        <input type="email" class="form-control" name="email" id="email" placeholder="Email Address" required>
        <label for="email">Email</label>
      </div>

      <!-- Password -->
      <div class="form-floating mb-3 position-relative">
        <input type="password" class="form-control" name="password" id="password" placeholder="Password" required>
        <label for="password">Password</label>
        <span class="toggle-password" onclick="togglePassword('password')">üëÅÔ∏è</span>
      </div>
      <progress id="passwordStrength" title="passwordStrength" max="100" value="0" class="w-100 mb-3"></progress>

      <!-- Confirm Password -->
      <div class="form-floating mb-3 position-relative">
        <input type="password" class="form-control" name="confirm_password" id="confirm_password" placeholder="Confirm Password" required>
        <label for="confirm_password">Confirm Password</label>
        <span class="toggle-password" onclick="togglePassword('confirm_password')">üëÅÔ∏è</span>
      </div>
      <div id="passwordError" class="text-danger mb-3"></div>

      <!-- College Name -->
      <div class="form-floating mb-3">
        <select class="form-select" name="college_name" id="collegeSelect" required>
          <option value="" disabled selected>Select College</option>
          {% for college in college %}
            <option value="{{ college.id }}">{{ college.name }}</option>
          {% endfor %}
        </select>
        <label for="collegeSelect">College Name</label>
      </div>

      <!-- Submit -->
      <div class="text-center">
        <button type="submit" class="btn btn-success px-5">Register</button>
        <button type="button" class="btn btn-secondary px-5" onclick="history.back();">Back</button>
      </div>
    </form>
  </div>
</div>

<script>
  // Show/hide password
  function togglePassword(id) {
    const input = document.getElementById(id);
    input.type = input.type === "password" ? "text" : "password";
  }

  // Confirm password match
  document.getElementById("studentForm").addEventListener("submit", function(e) {
    const pwd = document.getElementById("password").value.trim();
    const cpwd = document.getElementById("confirm_password").value.trim();
    if (pwd !== cpwd) {
      e.preventDefault();
      document.getElementById("passwordError").innerText = "Passwords do not match!";
      passwordStrengthBar.style.backgroundColor = "red";
    }
    else{
      passwordStrengthBar.style.backgroundColor = "blue";
    }

    // Set dynamic form action with selected college ID
    const collegeId = document.getElementById("collegeSelect").value;
    if (!collegeId) {
      e.preventDefault();
      alert("Please select a college.");
      return;
    }
    this.action = `/studentregister/${collegeId}/`;
  });

  // Live image preview
  document.getElementById("student_photo").addEventListener("change", function () {
    const file = this.files[0];
    if (file) {
      const preview = document.getElementById("photoPreview");
      preview.style.display = "block";
      preview.src = URL.createObjectURL(file);
    }
  });

  // Password strength
  document.getElementById("password").addEventListener("input", function () {
    const val = this.value;
    let score = 0;
    if (val.length >= 6) score += 25;
    if (/[A-Z]/.test(val)) score += 25;
    if (/[0-9]/.test(val)) score += 25;
    if (/[\W]/.test(val)) score += 25;
    document.getElementById("passwordStrength").value = score;
  });
</script>

</body>
</html>
