<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QR Scanner</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body class="bg-gray-100 min-h-screen p-4">
  <div class="max-w-md mx-auto bg-white rounded shadow p-6 text-center">
    <h1 class="text-2xl font-bold mb-4">ğŸ“· Scan Ticket QR Code</h1>
    <div id="qr-reader" style="width: 100%;"></div>
    <div id="result" class="mt-4 text-lg text-green-700 font-semibold"></div>
  </div>

  <script>
    function onScanSuccess(decodedText) {
      fetch('/verify_qr/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
          'X-CSRFToken': '{{ csrf_token }}'
        },
        body: `qr_data=${encodeURIComponent(decodedText)}`
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === 'valid') {
          document.getElementById('result').innerText =
            `âœ”ï¸ Valid Ticket for ${data.student}, ${data.department}\nRoute: ${data.route}\nValid Till: ${data.valid_till}`;
        } else {
          document.getElementById('result').innerText = 'âŒ Invalid QR Code';
        }
      });
    }

    new Html5Qrcode("qr-reader").start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 250 },
      onScanSuccess
    );
  </script>
</body>
</html>